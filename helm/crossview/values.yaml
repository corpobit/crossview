# Default values for crossview
# This is a YAML-formatted file.

# Global settings
global:
  namespace: crossview
  createNamespace: true

# Image configuration
image:
  repository: ghcr.io/corpobit/crossview
  pullPolicy: Always
  # Overrides the image tag. If empty, uses Chart.AppVersion (e.g., "1.5.0").
  # To pin to a specific version, set this to the version tag (e.g., "1.5.0" or "v1.5.0")
  # Alternative: Use Docker Hub by setting repository to "corpobit/crossview"
  tag: ""
  # Platform override for multi-arch support (e.g., "linux/amd64" for ARM64 hosts)
  platform: ""

# Application configuration
app:
  name: crossview
  port: 3001
  replicas: 1
  extraEnv: []
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
    seccompProfile:
      type: RuntimeDefault
  containerSecurityContext:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false
    runAsNonRoot: true
    runAsUser: 1000
    capabilities:
      drop:
        - ALL

# Deployment strategy
deployment:
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0

# Resource limits and requests
# Defaults are set for typical clusters. If the pod is OOMKilled when opening the dashboard,
# increase memory (e.g. 1Giâ€“2Gi); see docs/TROUBLESHOOTING.md#oomkilled-when-opening-the-dashboard.
resources:
  requests:
    memory: "256Mi"
    cpu: "250m"
  limits:
    memory: "1Gi"
    cpu: "1000m"

# Health checks
healthCheck:
  livenessProbe:
    httpGet:
      path: /api/health
      port: 3001
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  readinessProbe:
    httpGet:
      path: /api/health
      port: 3001
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

# Service configuration
service:
  type: ClusterIP
  port: 80
  targetPort: 3001
  sessionAffinity: ClientIP
  sessionAffinityTimeout: 10800
  annotations: {}

# Ingress configuration
ingress:
  enabled: false
  className: nginx
  annotations:
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    # cert-manager.io/cluster-issuer: "letsencrypt-prod"
  hosts:
    - host: crossview.example.com
      paths:
        - path: /
          pathType: Prefix
  tls: []
    # - secretName: crossview-tls
    #   hosts:
    #     - crossview.example.com

# Database configuration
database:
  enabled: true
  image:
    repository: postgres
    tag: "latest"
  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  persistence:
    enabled: true
    size: 10Gi
    accessMode: ReadWriteOnce
    storageClass: ""
  podAnnotations: {}
  podLabels: {}
  service:
    annotations: {}
  extraEnv: []
  securityContext:
    runAsNonRoot: true
    runAsUser: 999
    fsGroup: 999
    seccompProfile:
      type: RuntimeDefault
  containerSecurityContext:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false
    runAsNonRoot: true
    runAsUser: 999
    capabilities:
      drop:
        - ALL

# Configuration
# If config.ref is set, the chart will use an existing ConfigMap (must contain 'config.yaml' key)
# If config.ref is not set, the chart will generate config.yaml from the config section below
config:
  # Reference to an existing ConfigMap (if set, ConfigMap creation is skipped)
  # The existing ConfigMap should contain a 'config.yaml' key with the full configuration file
  ref: ""  # Set to your ConfigMap name, e.g., "my-crossview-config"
  
  # Configuration structure (matches config.yaml.example)
  # Only used if config.ref is not set
  database:
    host: ""  # Empty means auto-detect: {{ include "crossview.fullname" . }}-postgres
    port: 5432
    database: crossview
    username: postgres
    # password is set from secrets.dbPassword
  
  server:
    port: 3001
    log:
      level: info  # Options: debug, info, warn, error, fatal, panic
    cors:
      origin: http://localhost:5173
      credentials: true
    session:
      # secret is set from secrets.sessionSecret
      cookie:
        secure: false
        httpOnly: true
        maxAge: 86400000  # 24 hours in milliseconds
  
  sso:
    enabled: false
    oidc:
      enabled: false
      issuer: http://localhost:8080/realms/crossview
      clientId: crossview-client
      clientSecret: ""
      authorizationURL: ""
      tokenURL: ""
      userInfoURL: ""
      callbackURL: http://localhost:3001/api/auth/oidc/callback
      scope: openid profile email
      usernameAttribute: preferred_username
      emailAttribute: email
      firstNameAttribute: given_name
      lastNameAttribute: family_name
    saml:
      enabled: false
      entryPoint: http://localhost:8080/realms/crossview/protocol/saml
      issuer: crossview
      cert: null
      callbackURL: http://localhost:3001/api/auth/saml/callback
      usernameAttribute: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name
      emailAttribute: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress
      firstNameAttribute: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname
      lastNameAttribute: http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname
  
  vite:
    server:
      proxy:
        api:
          target: http://localhost:3001
          changeOrigin: true

# Secrets (should be set via --set or secrets file)
# Each secret can be:
#   - A string: Direct value (creates a secret)
#   - An object with secretKeyRef: Reference to existing secret
#   - An object with configMapKeyRef: Reference to existing configmap
secrets:
  dbPassword: ""  # String value OR object: {secretKeyRef: {name: "my-secret", key: "password"}} OR {configMapKeyRef: {name: "my-config", key: "password"}}
  sessionSecret: ""  # String value OR object: {secretKeyRef: {name: "my-secret", key: "session"}} OR {configMapKeyRef: {name: "my-config", key: "session"}}
  existingSecret: ""  # DEPRECATED: Use dbPassword/sessionSecret as objects instead
  existingSecretKeys:
    dbPassword: "db-password"  # DEPRECATED: Use dbPassword as object instead
    sessionSecret: "session-secret"  # DEPRECATED: Use sessionSecret as object instead

# Service Account
serviceAccount:
  create: true
  name: crossview-sa
  annotations: {}

# RBAC
rbac:
  create: true
  clusterRole:
    name: crossview-role
  clusterRoleBinding:
    name: crossview-binding

# Pod affinity
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app
                operator: In
                values:
                  - crossview
          topologyKey: kubernetes.io/hostname

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Pod annotations (applied to app pods)
podAnnotations: {}

# Pod labels (applied to app pods)
podLabels: {}


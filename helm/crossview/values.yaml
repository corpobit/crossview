# Default values for crossview
# This is a YAML-formatted file.

# Global settings
global:
  namespace: crossview
  createNamespace: true

# Image configuration
image:
  repository: corpobit/crossview
  pullPolicy: Always
  # Overrides the image tag. Default is "latest" to always use the latest released image.
  # To pin to a specific version, set this to the version tag (e.g., "v2.1.0")
  tag: ""
  # Platform override for multi-arch support (e.g., "linux/amd64" for ARM64 hosts)
  platform: ""

# Application configuration
app:
  name: crossview
  port: 3001
  replicas: 3
  extraEnv: []
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
    seccompProfile:
      type: RuntimeDefault
  containerSecurityContext:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false
    runAsNonRoot: true
    runAsUser: 1000
    capabilities:
      drop:
        - ALL

# Deployment strategy
deployment:
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxSurge: 1
      maxUnavailable: 0

# Resource limits and requests
resources:
  requests:
    memory: "256Mi"
    cpu: "250m"
  limits:
    memory: "512Mi"
    cpu: "500m"

# Health checks
healthCheck:
  livenessProbe:
    httpGet:
      path: /api/health
      port: 3001
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  readinessProbe:
    httpGet:
      path: /api/health
      port: 3001
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

# Service configuration
service:
  type: ClusterIP
  port: 80
  targetPort: 3001
  sessionAffinity: ClientIP
  sessionAffinityTimeout: 10800
  annotations: {}

# Ingress configuration
ingress:
  enabled: false
  className: nginx
  annotations:
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    # cert-manager.io/cluster-issuer: "letsencrypt-prod"
  hosts:
    - host: crossview.example.com
      paths:
        - path: /
          pathType: Prefix
  tls: []
    # - secretName: crossview-tls
    #   hosts:
    #     - crossview.example.com

# Database configuration
database:
  enabled: true
  image:
    repository: postgres
    tag: "16.3-alpine"
  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  persistence:
    enabled: true
    size: 10Gi
    accessMode: ReadWriteOnce
    storageClass: ""
  podAnnotations: {}
  podLabels: {}
  service:
    annotations: {}
  extraEnv: []
  securityContext:
    runAsNonRoot: true
    runAsUser: 999
    fsGroup: 999
    seccompProfile:
      type: RuntimeDefault
  containerSecurityContext:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false
    runAsNonRoot: true
    runAsUser: 999
    capabilities:
      drop:
        - ALL

# Environment variables
env:
  NODE_ENV: "production"
  PORT: "3001"
  # DB_HOST will be automatically set to the postgres service name based on release name
  # If you need to override, set it explicitly (e.g., for external database)
  DB_HOST: ""  # Empty means use template: {{ include "crossview.fullname" . }}-postgres
  DB_PORT: "5432"
  DB_NAME: "crossview"
  DB_USER: "postgres"

# Secrets (should be set via --set or secrets file)
secrets:
  dbPassword: ""  # Set via --set secrets.dbPassword=your-password
  sessionSecret: ""  # Set via --set secrets.sessionSecret=your-secret
  existingSecret: ""  # Reference existing secret name (if set, secret creation is skipped)
  existingSecretKeys:
    dbPassword: "db-password"  # Key in existing secret for DB password
    sessionSecret: "session-secret"  # Key in existing secret for session secret

# Service Account
serviceAccount:
  create: true
  name: crossview-sa
  annotations: {}

# RBAC
rbac:
  create: true
  clusterRole:
    name: crossview-role
  clusterRoleBinding:
    name: crossview-binding

# Pod affinity
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app
                operator: In
                values:
                  - crossview
          topologyKey: kubernetes.io/hostname

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Pod annotations (applied to app pods)
podAnnotations: {}

# Pod labels (applied to app pods)
podLabels: {}

